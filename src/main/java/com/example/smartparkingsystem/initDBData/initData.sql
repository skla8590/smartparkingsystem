
-- admin: 1234, test: 1111, test1: test1
INSERT INTO admin
(admin_id, password, admin_name, admin_email, is_active, last_login, last_login_ip, created_at)
VALUES ('admin', '$2a$12$hvk0XVGUYQk2BwV4SZ9Sz.xCrkCOCgQ3KGCv.QI77JGdJZ9Ri2usW', '관리자', 'allenis@naver.com', true, NULL,
        NULL, NOW()),
       ('test', '$2a$12$D0Tcf..4G2y8woY2HgB9veF.yjdoUeiI2yMymm8xVIOLB8yv7mjmO', 'Test', 'test@naver.com', false, NULL,
        NULL, NOW()),
       ('test1', '$2a$12$teiNyPb2nUP6vMA9aoQL/OeXC01FtycxknhHtm10CSj4SU/VqQIG6', 'Test1', 'test1@naver.com', true, NULL,
        NULL, NOW());



INSERT INTO `members` (`car_num`, `member_name`, `member_phone`, `start_date`, `end_date`, `member_charge`) VALUES
-- ===================== 2024년 (30건, 30%) =====================
('12가1234', '김민준', '010-3827-5941', '2024-01-05', '2024-02-04', 100000),
('234나5678', '이서연', '011-4729-1038', '2024-01-22', '2024-02-21', 100000),
('45다9012', '박지호', '010-8163-4752', '2024-02-08', '2024-03-09', 100000),
('678라3456', '최수아', '011-2947-6813', '2024-02-25', '2024-03-26', 100000),
('89마7890', '정우진', '010-5384-2917', '2024-03-11', '2024-04-10', 100000),
('123바1234', '강하늘', '011-7261-8034', '2024-03-28', '2024-04-27', 100000),
('56사5678', '윤지민', '010-4918-3726', '2024-04-14', '2024-05-14', 100000),
('789아9012', '임도현', '011-6037-2849', '2024-05-02', '2024-06-01', 100000),
('23자3456', '한소희', '010-2748-9163', '2024-05-19', '2024-06-18', 100000),
('456차7890', '오민서', '011-9174-5328', '2024-06-05', '2024-07-05', 100000),
('78카1234', '신준혁', '010-6392-1847', '2024-06-22', '2024-07-22', 100000),
('912타5678', '류지은', '011-3816-7429', '2024-07-09', '2024-08-08', 100000),
('34파9012', '배현우', '010-7243-5916', '2024-07-26', '2024-08-25', 100000),
('567하3456', '노아름', '011-5927-4183', '2024-08-12', '2024-09-11', 100000),
('89거7890', '문지훈', '010-1836-7294', '2024-08-29', '2024-09-28', 100000),
('123너1234', '권나연', '011-8274-3961', '2024-09-15', '2024-10-15', 100000),
('45더5678', '황태양', '010-3619-8247', '2024-10-02', '2024-11-01', 100000),
('678러9012', '송예진', '011-4782-1639', '2024-10-19', '2024-11-18', 100000),
('89머3456', '전민호', '010-9163-4728', '2024-11-05', '2024-12-05', 100000),
('123버7890', '조하린', '011-2847-9361', '2024-11-22', '2024-12-22', 100000),
('56서1234', '남기현', '010-7491-2836', '2024-12-03', '2025-01-02', 100000),
('789어5678', '마지수', '011-6318-4927', '2024-01-30', '2024-02-29', 100000),
('23저9012', '홍준서', '010-4827-1693', '2024-04-01', '2024-05-01', 100000),
('456처3456', '유소현', '011-3196-8274', '2024-07-17', '2024-08-16', 100000),
('78커7890', '도재원', '010-8274-3619', '2024-09-04', '2024-10-04', 100000),
('912터1234', '석민아', '011-1947-6382', '2024-10-21', '2024-11-20', 100000),
('34퍼5678', '엄지현', '010-6382-9147', '2024-11-08', '2024-12-08', 100000),
('567허9012', '방도윤', '011-7219-4836', '2024-12-10', '2025-01-09', 100000),
('89고3456', '표나리', '010-2836-7194', '2024-03-20', '2024-04-19', 100000),
('123노7890', '구하준', '011-4963-2817', '2024-08-05', '2024-09-04', 100000),

-- ===================== 2025년 (25건, 25%) =====================
('45도1234', '심예원', '010-8147-6392', '2025-01-08', '2025-02-07', 100000),
('678로5678', '안지성', '011-3728-1964', '2025-01-25', '2025-02-24', 100000),
('89모9012', '백수민', '010-5963-4817', '2025-02-11', '2025-03-13', 100000),
('123보3456', '진하은', '011-2174-8639', '2025-02-26', '2025-03-28', 100000),
('56소7890', '탁준혁', '010-7836-2941', '2025-03-14', '2025-04-13', 100000),
('789오1234', '편미래', '011-6492-3718', '2025-03-31', '2025-04-30', 100000),
('23조5678', '하은솔', '010-3917-8264', '2025-04-17', '2025-05-17', 100000),
('456초9012', '가온누리', '011-8264-1937', '2025-05-04', '2025-06-03', 100000),
('78코3456', '나찬빈', '010-1749-5382', '2025-05-21', '2025-06-20', 100000),
('912토7890', '다온아', '011-5382-7194', '2025-06-07', '2025-07-07', 100000),
('34포1234', '라율이', '010-9274-1836', '2025-06-24', '2025-07-24', 100000),
('567호5678', '마루한', '011-7163-4928', '2025-07-11', '2025-08-10', 100000),
('89고9012', '바다솔', '010-4928-7163', '2025-07-28', '2025-08-27', 100000),
('123가3456', '사랑이', '011-2837-6194', '2025-08-14', '2025-09-13', 100000),
('45나7890', '아름찬', '010-6194-3827', '2025-08-31', '2025-09-30', 100000),
('678다1234', '자연인', '011-3748-9261', '2025-09-17', '2025-10-17', 100000),
('89라5678', '차민성', '010-8261-4739', '2025-10-04', '2025-11-03', 100000),
('123마9012', '카리나', '011-1936-7482', '2025-10-21', '2025-11-20', 100000),
('56바3456', '타라은', '010-7482-2916', '2025-11-07', '2025-12-07', 100000),
('789사7890', '파란별', '011-4917-8263', '2025-11-24', '2025-12-24', 100000),
('23아1234', '하늘빛', '010-2963-1847', '2025-01-14', '2025-02-13', 100000),
('456자5678', '거울상', '011-6184-3927', '2025-04-03', '2025-05-03', 100000),
('78차9012', '너울파', '010-3927-6184', '2025-07-19', '2025-08-18', 100000),
('912카3456', '더나은', '011-8293-4716', '2025-09-30', '2025-10-30', 100000),
('34타7890', '러일출', '010-4716-8293', '2025-12-12', '2026-01-11', 100000),

-- ===================== 2026년 (45건, 45%) =====================
('567파1234', '머루알', '011-7384-2916', '2026-01-02', '2026-02-01', 100000),
('89하5678', '버드나', '010-2916-7384', '2026-01-05', '2026-02-04', 100000),
('123거9012', '서리꽃', '011-5827-1394', '2026-01-08', '2026-02-07', 100000),
('45너3456', '어깨동', '010-1394-5827', '2026-01-11', '2026-02-10', 100000),
('678더7890', '저녁놀', '011-9261-4738', '2026-01-14', '2026-02-13', 100000),
('89러1234', '초록빛', '010-4738-9261', '2026-01-17', '2026-02-16', 100000),
('123머5678', '크리스', '011-3849-7162', '2026-01-20', '2026-02-19', 100000),
('56버9012', '트리온', '010-7162-3849', '2026-01-23', '2026-02-22', 100000),
('789서3456', '푸른봄', '011-6273-1948', '2026-01-26', '2026-02-25', 100000),
('23어7890', '하람이', '010-1948-6273', '2026-01-29', '2026-02-28', 100000),
('456저1234', '가람빛', '011-8362-4917', '2026-02-01', '2026-03-03', 100000),
('78처5678', '나루터', '010-4917-8362', '2026-02-03', '2026-03-05', 100000),
('912커9012', '다솜이', '011-2794-6381', '2026-02-05', '2026-03-07', 100000),
('34터3456', '라온삶', '010-6381-2794', '2026-02-07', '2026-03-09', 100000),
('567퍼7890', '마루치', '011-4916-8273', '2026-02-09', '2026-03-11', 100000),
('89허1234', '바솔빛', '010-8273-4916', '2026-02-11', '2026-03-13', 100000),
('123고5678', '사계절', '011-3618-7294', '2026-02-13', '2026-03-15', 100000),
('45노9012', '아리수', '010-7294-3618', '2026-01-03', '2026-02-02', 100000),
('678도3456', '자리끼', '011-1847-5392', '2026-01-06', '2026-02-05', 100000),
('89로7890', '차오름', '010-5392-1847', '2026-01-09', '2026-02-08', 100000),
('123모1234', '카나리', '011-9273-6184', '2026-01-12', '2026-02-11', 100000),
('56보5678', '타임리', '010-6184-9273', '2026-01-15', '2026-02-14', 100000),
('789소9012', '파도소', '011-4839-2716', '2026-01-18', '2026-02-17', 100000),
('23오3456', '하온별', '010-2716-4839', '2026-01-21', '2026-02-20', 100000),
('456조7890', '거센빛', '011-7492-3816', '2026-01-24', '2026-02-23', 100000),
('78초1234', '너름세', '010-3816-7492', '2026-01-27', '2026-02-26', 100000),
('912코5678', '더없이', '011-8174-2639', '2026-01-30', '2026-03-01', 100000),
('34토9012', '러브유', '010-2639-8174', '2026-02-02', '2026-03-04', 100000),
('567포3456', '마음결', '011-6392-4817', '2026-02-04', '2026-03-06', 100000),
('89호7890', '바람개', '010-4817-6392', '2026-02-06', '2026-03-08', 100000),
('123가1357', '사름이', '011-2948-7163', '2026-02-08', '2026-03-10', 100000),
('45나2468', '아련함', '010-7163-2948', '2026-02-10', '2026-03-12', 100000),
('678다3579', '자유인', '011-5284-9173', '2026-02-12', '2026-03-14', 100000),
('89라4680', '차가운', '010-9173-5284', '2026-02-14', '2026-03-16', 100000),
('123마5791', '카운트', '011-3716-8492', '2026-02-16', '2026-03-18', 100000),
('56바6802', '타오름', '010-8492-3716', '2026-01-04', '2026-02-03', 100000),
('789사7913', '파동선', '011-1938-6274', '2026-01-07', '2026-02-06', 100000),
('23아8024', '하얀길', '010-6274-1938', '2026-01-10', '2026-02-09', 100000),
('456자9135', '거침없', '011-4817-2693', '2026-01-13', '2026-02-12', 100000),
('78차1246', '나지막', '010-2693-4817', '2026-01-16', '2026-02-15', 100000),
('912카2357', '다가온', '011-7362-1948', '2026-01-19', '2026-02-18', 100000),
('34타3468', '라일락', '010-1948-7362', '2026-01-22', '2026-02-21', 100000),
('567파4579', '마지막', '011-5194-8327', '2026-01-25', '2026-02-24', 100000),
('89하5680', '바탕화', '010-8327-5194', '2026-01-28', '2026-02-27', 100000),
('123거6791', '서울빛', '011-3948-7216', '2026-01-31', '2026-03-02', 100000);


-- 기본 정책
INSERT INTO payment_info
(free_time, basic_time, extra_time, basic_charge, extra_charge, max_charge, small_car_discount, disabled_discount, is_active, admin_id, member_charge)
VALUES
    (10, 60, 30, 2000, 1000, 15000, 0.3, 0.5, TRUE, 'admin', 100000);






INSERT INTO parking_history
(parking_area, car_num, car_type, is_member, entry_time, exit_time, total_minutes)
SELECT
    parking_area,
    car_num,
    CASE
        WHEN (ABS(CAST(CONV(SUBSTRING(MD5(car_num), 1, 8), 16, 10) AS SIGNED)) % 100) < 85 THEN '일반'
        WHEN (ABS(CAST(CONV(SUBSTRING(MD5(car_num), 1, 8), 16, 10) AS SIGNED)) % 100) < 97 THEN '경차'
        ELSE '장애인'
        END AS car_type,
    is_member,
    entry_time,
    TIMESTAMPADD(MINUTE, total_minutes, entry_time) AS exit_time,
    total_minutes
FROM (
         -- =============================================
         -- 1. 회원 주차 기록 (3,000건)
         -- =============================================
         (SELECT
              parking_area,
              car_num,
              is_member,
              --  외부에서 rand_val 참조 → 행마다 다른 시간대 버킷
              TIMESTAMP(
              date_part,
              SEC_TO_TIME(
              CASE
              WHEN rand_val < 0.03 THEN FLOOR(RAND() * 28800)              -- 3%  : 00~08시 (새벽)
              WHEN rand_val < 0.15 THEN FLOOR(28800 + RAND() * 3600)       -- 12% : 08~09시
              WHEN rand_val < 0.38 THEN FLOOR(32400 + RAND() * 3600)       -- 23% : 09~10시 ★ 피크
              WHEN rand_val < 0.55 THEN FLOOR(36000 + RAND() * 7200)       -- 17% : 10~12시
              WHEN rand_val < 0.68 THEN FLOOR(43200 + RAND() * 10800)      -- 13% : 12~15시
              WHEN rand_val < 0.80 THEN FLOOR(54000 + RAND() * 10800)      -- 12% : 15~18시
              WHEN rand_val < 0.93 THEN FLOOR(64800 + RAND() * 10800)      -- 13% : 18~21시
              ELSE                      FLOOR(75600 + RAND() * 10799)      -- 7%  : 21~24시 (86399초 상한)
              END
              )
         ) AS entry_time,
              total_minutes
          FROM (
                   --  핵심: SELECT 안에 RAND() → 행마다 독립 평가
                   SELECT
                       CONCAT('A', FLOOR(RAND() * 20 + 1))                            AS parking_area,
                       m.car_num                                                        AS car_num,
                       TRUE                                                             AS is_member,
                       RAND()                                                           AS rand_val,  -- ← 행마다 고유값
                       LEAST(
                               m.start_date + INTERVAL FLOOR(RAND() * DATEDIFF(LEAST(m.end_date, '2026-02-11'), m.start_date)) DAY,
                               '2026-02-11'
                       )                                                                AS date_part,
                       CASE
                           WHEN RAND() < 0.9 THEN FLOOR(RAND() * 240 + 30)
                           ELSE FLOOR(RAND() * 1440 + 240)
                           END                                                              AS total_minutes
                   FROM members m
                            CROSS JOIN (SELECT 1 UNION SELECT 2 UNION SELECT 3 UNION SELECT 4 UNION SELECT 5) AS t
                   WHERE m.start_date <= '2026-02-11'
                   LIMIT 3000
               ) AS member_inner)

UNION ALL

-- =============================================
-- 2. 비회원 주차 기록 (7,000건)
-- =============================================
(SELECT
     parking_area,
     car_num,
     is_member,
     TIMESTAMP(
     date_part,
     SEC_TO_TIME(
     CASE
     WHEN rand_val < 0.03 THEN FLOOR(RAND() * 28800)
     WHEN rand_val < 0.15 THEN FLOOR(28800 + RAND() * 3600)
     WHEN rand_val < 0.38 THEN FLOOR(32400 + RAND() * 3600)       -- ★ 피크
     WHEN rand_val < 0.55 THEN FLOOR(36000 + RAND() * 7200)
     WHEN rand_val < 0.68 THEN FLOOR(43200 + RAND() * 10800)
     WHEN rand_val < 0.80 THEN FLOOR(54000 + RAND() * 10800)
     WHEN rand_val < 0.93 THEN FLOOR(64800 + RAND() * 10800)
     ELSE                      FLOOR(75600 + RAND() * 10799)
     END
     )
) AS entry_time,
              total_minutes
          FROM (
                   SELECT
                       CONCAT('A', FLOOR(RAND() * 20 + 1))                            AS parking_area,
                       CONCAT(
                               IF(RAND() > 0.5, FLOOR(RAND() * 90 + 10), FLOOR(RAND() * 900 + 100)),
                               ELT(FLOOR(RAND() * 5) + 1, '가', '나', '다', '라', '마'),
                               LPAD(FLOOR(RAND() * 9000 + 1000), 4, '0')
                       )                                                                AS car_num,
                       FALSE                                                            AS is_member,
                       RAND()                                                           AS rand_val,  -- ← 행마다 고유값
                       DATE_ADD('2024-01-01', INTERVAL FLOOR(RAND() * 772) DAY)        AS date_part,
                       CASE
                           WHEN RAND() < 0.9 THEN FLOOR(RAND() * 240 + 30)
                           ELSE FLOOR(RAND() * 1440 + 240)
                           END                                                              AS total_minutes
                   FROM information_schema.columns c1, information_schema.columns c2
                   LIMIT 7000
               ) AS nonmember_inner)
     ) AS combined_data
ORDER BY entry_time;


-- 1. 활성화된 정책 정보 로드 (변수 할당)
SELECT
    @p_no := pno,
    @f_time := free_time,
    @b_time := basic_time,
    @e_time := extra_time,
    @b_charge := basic_charge,
    @e_charge := extra_charge,
    @m_charge := max_charge,
    @s_disc := small_car_discount,
    @d_disc := disabled_discount
FROM payment_info
ORDER BY updated_at DESC
    LIMIT 1;

-- 2. 결제 이력 데이터 삽입
INSERT INTO payment_history
(parking_area, car_num, entry_time, exit_time, total_minutes, total_charge,
 mno, pno, park_no, discount_amount, final_charge, is_paid, payment_time)
SELECT
    ph.parking_area,
    ph.car_num,
    ph.entry_time,
    ph.exit_time,
    ph.total_minutes,
    -- 원가 계산 (회차 무료, 기본요금, 추가요금, 일일최대 적용)
    @raw_fee := (
        CASE
            WHEN ph.total_minutes <= @f_time THEN 0
            WHEN ph.total_minutes <= @b_time THEN @b_charge
            ELSE LEAST(@m_charge, @b_charge + (CEIL((ph.total_minutes - @b_time) / @e_time) * @e_charge))
            END
        ) AS total_charge,
    m.mno,
    @p_no AS pno,
    ph.park_no,
    -- 할인액 계산 (월정액 무료 > 장애인 > 경차 순)
    @discount := (
        CASE
            WHEN ph.is_member = TRUE THEN @raw_fee
            WHEN ph.car_type = '장애인' THEN @raw_fee * @d_disc
            WHEN ph.car_type = '경차' THEN @raw_fee * @s_disc
            ELSE 0
            END
        ) AS discount_amount,
    -- 최종 결제액
    (@raw_fee - @discount) AS final_charge,
    TRUE AS is_paid,
    ph.exit_time AS payment_time
FROM parking_history ph
    LEFT JOIN members m ON ph.car_num = m.car_num
    AND ph.entry_time BETWEEN m.start_date AND m.end_date;